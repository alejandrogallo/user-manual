<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="viewport" content="width=device-width, initial-scale=1" />

      <title>Performance and compute resources</title>
    
          <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../_static/theme-vendors.js"></script> -->
      <script src="../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Contact" href="../contact/contact.html" />
  <link rel="prev" title="About the code" href="../what/what.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">CC4S</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#cc4s-user-documentation">cc4s user documentation</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="../gettingstarted/gettingstarted.html" class="reference internal ">Getting Started</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../algorithms/index.html" class="reference internal ">Algorithms</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../objects/index.html" class="reference internal ">Objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../interfaces/vasp.html" class="reference internal ">Description of VASP interface to Cc4s</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../tutorials/Rbn_tutorial.html" class="reference internal ">How to run Cc4s calculations?</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../what/what.html" class="reference internal ">About the code</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Performance and compute resources</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#generating-the-input-file" class="reference internal">1 Generating the input file</a></li>
                
                  <li class="toctree-l2"><a href="#dry-and-full-calculation" class="reference internal">2 Dry and full calculation</a></li>
                
                  <li class="toctree-l2"><a href="#exploited-benchmarks" class="reference internal">3 Exploited benchmarks</a></li>
                
                  <li class="toctree-l2"><a href="#literature" class="reference internal">4 Literature</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../contact/contact.html" class="reference internal ">Contact</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../how-to-write.html" class="reference internal ">How To Write</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li>Performance and compute resources</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../what/what.html"
       title="previous chapter">← About the code</a>
  </li>
  <li class="next">
    <a href="../contact/contact.html"
       title="next chapter">Contact →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="performance-and-compute-resources">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Performance and compute resources</a><a class="headerlink" href="#performance-and-compute-resources" title="Link to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#performance-and-compute-resources" id="id1">Performance and compute resources</a></p>
<ul>
<li><p><a class="reference internal" href="#generating-the-input-file" id="id2">1 Generating the input file</a></p></li>
<li><p><a class="reference internal" href="#dry-and-full-calculation" id="id3">2 Dry and full calculation</a></p></li>
<li><p><a class="reference internal" href="#exploited-benchmarks" id="id4">3 Exploited benchmarks</a></p></li>
<li><p><a class="reference internal" href="#literature" id="id5">4 Literature</a></p></li>
</ul>
</li>
</ul>
</nav>
<p><code class="docutils literal notranslate"><span class="pre">Cc4s</span></code> is designed to run highly parallel coupled cluster calculations.  It
allows calculations with far more than 100 electrons on modern high performance
computing clusters. Currently, <code class="docutils literal notranslate"><span class="pre">Cc4s</span></code> can not benefit from GPUs or other
accelerators.
Note: although OpenMP threading is generally supported it is recommended to set</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>In the following we present a way to estimate the required compute resources
for models with arbitrary system sizes that can be chosen to reflect the dimensions
of any targeted ab initio system.
In this manner <code class="docutils literal notranslate"><span class="pre">Cc4s</span></code> does not require actual input files for the specific ab initio
system.
The computational complexity can be estimated on two levels. First, a dry
calculation can be performed which gives a first overview of the time and
memory consumptions of the calculation. Thereafter, a full calculation can be
performed to examine the performance on the target system. Note that the
performance depends heavily on the hardware, network, compilers, and libraries.</p>
<section id="generating-the-input-file">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">1 Generating the input file</a><a class="headerlink" href="#generating-the-input-file" title="Link to this heading">¶</a></h2>
<p>The only input required are the dimensions of the desired calculation.  It is
important to note that the performance depends only on the dimensions of the
system as given below. Physical properties (periodic vs. molecular system, low
bandgap vs.  high bandgap, etc.) have no impact.</p>
<p>The most important system parameter is the number of electrons used in the post
Hartree–Fock calculation (core electrons are typically not considered).  In
<code class="docutils literal notranslate"><span class="pre">vasp</span></code> the number of valence electrons of a given  atom is given in the POTCAR
file (ZVAL); the other electrons are treated within the frozen-core approximation
(<a class="reference external" href="https://www.vasp.at/wiki/index.php/POTCAR">https://www.vasp.at/wiki/index.php/POTCAR</a>).
In a closed-shell calculation the
number of occupied orbitals <span class="math notranslate nohighlight">\(N_o\)</span> is half the number of valence electrons
<span class="math notranslate nohighlight">\(N_\text{elec}\)</span>.  When using the <a class="reference external" href="../algorithms/BasisSetCorrection.html">basis-set
correction</a> typically 8-16 virtual orbitals per occupied orbital are needed to
obtain converged results (see Ref. (Irmler, Andreas and Gallo, Alejandro and Grüneis, Andreas, 2021)).  Further
input parameter is the number of field variables of the vertex <span class="math notranslate nohighlight">\(N_\text{F}\)</span>. It
has been shown that for converged results this number can be chosen as small
as 2-3 times <span class="math notranslate nohighlight">\(N_v\)</span>.</p>
<p>An exemplary snippet of the algorithm creating the required vertex reads</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UegVertexGenerator</span>
<span class="w">  </span><span class="nt">in</span><span class="p">:</span>
<span class="w">    </span><span class="nt">No</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
<span class="w">    </span><span class="nt">Nv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1114</span>
<span class="w">    </span><span class="nt">NF</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span>
<span class="w">    </span><span class="nt">halfGrid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">rs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">out</span><span class="p">:</span>
<span class="w">    </span><span class="nt">eigenEnergies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EigenEnergies</span>
<span class="w">    </span><span class="nt">coulombVertex</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CoulombVertex</span>
</pre></div>
</div>
<p>The value for <span class="math notranslate nohighlight">\(r_s\)</span> can be chosen to be any positiv real number (it will be
irrelevant for the performance  analysis). The pseudo-boolean variable
<code class="docutils literal notranslate"><span class="pre">halfGrid</span></code> is chosen to be <span class="math notranslate nohighlight">\(1\)</span> for $:math:<cite>Gamma`$-point or molecular calculations,
and :math:`0</cite> for arbitrary $k$-point calculations where the wavefunctions is
complex.</p>
<p>A full input file for a CCSD calculation can be found at
(<a class="reference external" href="https://gitlab.cc4s.html/cc4s/cc4s/-/raw/master/test/tests/ueg/rs1.0-123occ-1114virt/cc4s.in">https://gitlab.cc4s.html/cc4s/cc4s/-/raw/master/test/tests/ueg/rs1.0-123occ-1114virt/cc4s.in</a>).</p>
</section>
<section id="dry-and-full-calculation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">2 Dry and full calculation</a><a class="headerlink" href="#dry-and-full-calculation" title="Link to this heading">¶</a></h2>
<p>The generated input file can either be used in a dry calculation (running a
few seconds on a laptop device), or in a real calculation on the desired
target machine.</p>
<p>The dry calculation is called with the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">$Cc4s</span><span class="w"> </span>-i<span class="w"> </span>cc4s.in<span class="w"> </span>-d<span class="w"> </span><span class="m">1536</span>
</pre></div>
</div>
<p>In this example we obtain an output for 1536 mpi ranks. The output stream reads</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">                </span>__<span class="w"> </span>__
<span class="w">     </span>__________/<span class="w"> </span>//<span class="w"> </span>/<span class="w"> </span>_____
<span class="w">    </span>/<span class="w"> </span>___/<span class="w"> </span>___/<span class="w"> </span>//<span class="w"> </span>/_/<span class="w"> </span>___/
<span class="w">   </span>/<span class="w"> </span>/__/<span class="w"> </span>/__/__<span class="w">  </span>__<span class="o">(</span>__<span class="w">  </span><span class="o">)</span>
<span class="w">   </span><span class="se">\_</span>__/<span class="se">\_</span>__/<span class="w">  </span>/_/<span class="w"> </span>/____/
<span class="w">  </span>Coupled<span class="w"> </span>Cluster<span class="w"> </span><span class="k">for</span><span class="w"> </span>Solids

version:<span class="w"> </span>heads/develop-0-g3467f0ad-dirty,<span class="w"> </span>date:<span class="w"> </span>Mon<span class="w"> </span>Mar<span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">11</span>:40:04<span class="w"> </span><span class="m">2022</span><span class="w"> </span>+0200
build<span class="w"> </span>date:<span class="w"> </span>Mar<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">16</span>:27:07
compiler:<span class="w"> </span>g++<span class="w"> </span><span class="o">(</span>Ubuntu<span class="w"> </span><span class="m">10</span>.3.0-1ubuntu1~20.10<span class="o">)</span><span class="w"> </span><span class="m">10</span>.3.0
total<span class="w"> </span>processes:<span class="w"> </span><span class="m">1</span>
calculation<span class="w"> </span>started<span class="w"> </span>on:<span class="w"> </span>Mon<span class="w"> </span>Apr<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:16:08<span class="w"> </span><span class="m">2022</span>

Dry<span class="w"> </span>run<span class="w"> </span>finished.<span class="w"> </span>Estimates<span class="w"> </span>provided<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">1536</span><span class="w"> </span>ranks.
Memory<span class="w"> </span>estimate<span class="w"> </span><span class="o">(</span>per<span class="w"> </span>Rank/Total<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>.51836<span class="w"> </span>/<span class="w"> </span><span class="m">2332</span>.2<span class="w"> </span>GB
Operations<span class="w"> </span>estimate<span class="w"> </span><span class="o">(</span>per<span class="w"> </span>Rank/Total<span class="o">)</span>:<span class="w"> </span><span class="m">912374</span><span class="w"> </span>/<span class="w"> </span><span class="m">1</span>.40141e+09<span class="w"> </span>GFLOPS
Time<span class="w"> </span>estimate<span class="w"> </span>with<span class="w"> </span>assumed<span class="w"> </span>performance<span class="w"> </span>of<span class="w"> </span><span class="m">10</span><span class="w"> </span>GFLOPS/core/s:<span class="w"> </span><span class="m">91237</span>.4<span class="w"> </span>s<span class="w"> </span><span class="o">(</span><span class="m">25</span>.3437<span class="w"> </span>h<span class="o">)</span>
--
</pre></div>
</div>
<p>The number of mpi ranks can be adjusted based on the memory/walltime
constrains.  Note that the given memory and time estimates can differ in the
real calculation and should only be used as an educated guess. The obtained
performance depends heavily on the hardware (CPU, network, …). The actual
memory requirements can be higher than estimated. Using only 50-75% of the
total available memory has shown to be a reasonable choice.</p>
<p>The full calculation is called by the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-np<span class="w"> </span><span class="nv">$ranks</span><span class="w"> </span><span class="nv">$Cc4s</span><span class="w"> </span>-i<span class="w"> </span>cc4s.in
</pre></div>
</div>
</section>
<section id="exploited-benchmarks">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">3 Exploited benchmarks</a><a class="headerlink" href="#exploited-benchmarks" title="Link to this heading">¶</a></h2>
<p>We have examined the performance of <code class="docutils literal notranslate"><span class="pre">Cc4s</span></code> on two different clusters both using
different Intel Xeon CPUs.
For the weak scaling benchmark the number of occupied orbitals was increased with growing node count.
The number of virtuals per occupied was set to 12 in all calculations. The number of field variables per virtual
was kept almost constant at a value of around 3.5.</p>
<table class="docutils align-default" id="irene-tab">
<caption><span class="caption-text">Weak scaling of CCSD on Irene with Intel Skylake 8168 CPUs.</span><a class="headerlink" href="#irene-tab" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>#Nodes</p></th>
<th class="head"><p>#Cores</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(N_o\)</span></p></th>
<th class="head"><p>Memory (GB/core)</p></th>
<th class="head"><p>Performance (GFLOPS/core/s)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>48</p></td>
<td><p>40</p></td>
<td><p>2.0</p></td>
<td><p>18.7</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>192</p></td>
<td><p>64</p></td>
<td><p>2.4</p></td>
<td><p>20.1</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>768</p></td>
<td><p>80</p></td>
<td><p>1.4</p></td>
<td><p>21.4</p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p>960</p></td>
<td><p>96</p></td>
<td><p>2.0</p></td>
<td><p>21.4</p></td>
</tr>
<tr class="row-even"><td><p>50</p></td>
<td><p>1296</p></td>
<td><p>108</p></td>
<td><p>1.4</p></td>
<td><p>20.2</p></td>
</tr>
<tr class="row-odd"><td><p>100</p></td>
<td><p>4800</p></td>
<td><p>128</p></td>
<td><p>1.4</p></td>
<td><p>19.4</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="raven-weak-tab">
<caption><span class="caption-text">Weak scaling of CCSD on raven with Intel CascadeLake 9242 CPUs.</span><a class="headerlink" href="#raven-weak-tab" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>#Nodes</p></th>
<th class="head"><p>#Cores</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(N_o\)</span></p></th>
<th class="head"><p>Memory (GB/core)</p></th>
<th class="head"><p>Performance (GFLOPS/core/s)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>72</p></td>
<td><p>40</p></td>
<td><p>1.3</p></td>
<td><p>19.8</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>288</p></td>
<td><p>64</p></td>
<td><p>1.6</p></td>
<td><p>22.3</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>576</p></td>
<td><p>80</p></td>
<td><p>1.9</p></td>
<td><p>25.1</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>1152</p></td>
<td><p>96</p></td>
<td><p>1.7</p></td>
<td><p>20.2</p></td>
</tr>
<tr class="row-even"><td><p>32</p></td>
<td><p>2304</p></td>
<td><p>108</p></td>
<td><p>1.5</p></td>
<td><p>27.1</p></td>
</tr>
<tr class="row-odd"><td><p>48</p></td>
<td><p>3456</p></td>
<td><p>128</p></td>
<td><p>1.9</p></td>
<td><p>26.1</p></td>
</tr>
<tr class="row-even"><td><p>64</p></td>
<td><p>4608</p></td>
<td><p>140</p></td>
<td><p>1.8</p></td>
<td><p>22.0</p></td>
</tr>
<tr class="row-odd"><td><p>80</p></td>
<td><p>5760</p></td>
<td><p>152</p></td>
<td><p>2.0</p></td>
<td><p>29.8</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="raven-strong-tab">
<caption><span class="caption-text">Strong scaling on of CCSD raven <span class="math notranslate nohighlight">\(N_o=123\)</span>, <span class="math notranslate nohighlight">\(N_v=1114\)</span>, <span class="math notranslate nohighlight">\(N_F=2000\)</span></span><a class="headerlink" href="#raven-strong-tab" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>#Nodes</p></th>
<th class="head"><p>#Cores</p></th>
<th class="head"><p>Memory (GB/core)</p></th>
<th class="head"><p>Performance (GFLOPS/core/s)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>12</p></td>
<td><p>864</p></td>
<td><p>1.40</p></td>
<td><p>31.1</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>1152</p></td>
<td><p>1.05</p></td>
<td><p>29.7</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>1728</p></td>
<td><p>0.70</p></td>
<td><p>23.9</p></td>
</tr>
<tr class="row-odd"><td><p>30</p></td>
<td><p>2160</p></td>
<td><p>0.56</p></td>
<td><p>21.1</p></td>
</tr>
<tr class="row-even"><td><p>40</p></td>
<td><p>2880</p></td>
<td><p>0.42</p></td>
<td><p>20.8</p></td>
</tr>
<tr class="row-odd"><td><p>48</p></td>
<td><p>3456</p></td>
<td><p>0.35</p></td>
<td><p>18.6</p></td>
</tr>
<tr class="row-even"><td><p>64</p></td>
<td><p>4608</p></td>
<td><p>0.26</p></td>
<td><p>16.0</p></td>
</tr>
<tr class="row-odd"><td><p>72</p></td>
<td><p>5184</p></td>
<td><p>0.23</p></td>
<td><p>17.2</p></td>
</tr>
<tr class="row-even"><td><p>80</p></td>
<td><p>5760</p></td>
<td><p>0.21</p></td>
<td><p>14.8</p></td>
</tr>
</tbody>
</table>
</section>
<section id="literature">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">4 Literature</a><a class="headerlink" href="#literature" title="Link to this heading">¶</a></h2>
<p>Irmler, Andreas and Gallo, Alejandro and Grüneis, Andreas (2021). <em>Focal-point approach with pair-specific cusp correction for coupled-cluster theory</em>, The Journal of Chemical Physics.</p>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../what/what.html"
       title="previous chapter">← About the code</a>
  </li>
  <li class="next">
    <a href="../contact/contact.html"
       title="next chapter">Contact →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 1980, CC4S Developers.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>